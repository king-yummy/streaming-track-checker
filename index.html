<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ê³¡ í™•ì¸ê¸°</title>

  <!-- Pretendard Web Font -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />

  <!-- Tailwind ì‚¬ì „ ì„¤ì • -->
  <script>
    window.tailwindConfig = {
      theme: {
        fontFamily: {
          sans: ['Pretendard', 'ui-sans-serif', 'system-ui'],
        },
      },
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* í˜„ì¬ ì¬ìƒ íŠ¸ë™ ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes bgShift {
      0%,100% { background-color: #dbeafe; }
      50%      { background-color: #bfdbfe; }
    }
    .playing {
      animation: bgShift 2.5s ease-in-out infinite;
    }
  </style>
</head>
<body class="font-sans bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <!-- í—¤ë” -->
  <header class="w-full max-w-md mt-2 mb-2 flex justify-center">
    <div class="inline-block">
      <h1 class="text-3xl font-extrabold tracking-tight whitespace-nowrap">ã€Œã‹ãã‚Œã‚“ã¼ã€ ìŠ¤íŠ¸ë¦¬ë° ë¦¬ìŠ¤íŠ¸</h1>
      <span class="block text-sm text-gray-500 mt-1 text-right">25.06.16 ver.</span>
    </div>
  </header>

  <!-- ì¬ìƒëª©ë¡ -->
  <main class="w-full max-w-md space-y-2 overflow-auto">
    <ul id="playlist" class="space-y-2"></ul>
  </main>

  <!-- ëŒ€ì‹œë³´ë“œ -->
  <section id="dashboard" class="w-full max-w-md mt-4 mb-2 p-4 bg-white rounded-2xl shadow flex flex-col items-center space-y-3">
    <h2 class="text-sm text-gray-600 font-semibold">16ì¼ ìì •ë¶€í„° ìŠ¤ë°ì´ ëŠê¸°ì§€ ì•Šì•˜ë‹¤ë©´!</h2>
    <div class="grid grid-cols-3 gap-4 w-full text-center">
      <div>
        <p class="text-[11px] text-gray-500 mb-1">ã‹ãã‚Œã‚“ã¼</p>
        <p class="text-2xl font-bold"><span id="count-kakurenbo">0</span>íšŒ</p>
      </div>
      <div>
        <p class="text-[11px] text-gray-500 mb-1">Rizz - JP</p>
        <p class="text-2xl font-bold"><span id="count-rizz">0</span>íšŒ</p>
      </div>
      <div>
        <p class="text-[11px] text-gray-500 mb-1">Chroma Drift - JP</p>
        <p class="text-2xl font-bold"><span id="count-chroma">0</span>íšŒ</p>
      </div>
    </div>
  </section>

  <!-- í‘¸í„° -->
  <footer class="w-full max-w-md text-center text-xs text-gray-500 mt-2 mb-4 space-y-2">
  <p>í”Œë ˆì´ë¸Œ ìŒì›ì´ê³µíŒ€ì˜ ìŠ¤íŠ¸ë¦¬ë° ë¦¬ìŠ¤íŠ¸ì— ë”°ë¼ ìš´ì˜ë˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
  <p>
    ë¬¸ì˜ ë° ê±´ì˜ì‚¬í•­ì€ X(íŠ¸ìœ„í„°)
    <strong>
      <a href="https://x.com/plave_pretty?s=21&t=KweQO4B2QEKZ954vZ1zJ5" target="_blank" rel="noopener"
         class="text-blue-600 hover:underline">@plave_pretty</a>
    </strong>
    ë¡œ ë³´ë‚´ì£¼ì„¸ìš”.
  </p>
  <p class="text-[10px] text-gray-400 mt-2">
    ì´ í˜ì´ì§€ëŠ” í”Œë ˆì´ë¸Œ íŒ¬ë¤ <strong>PLLI</strong>ë§Œì„ ìœ„í•´ ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.<br />
    íƒ€ íŒ¬ë¤ì—ì„œì˜ ë¬´ë‹¨ ë³µì œÂ·ì¬ê°€ê³µÂ·ì‚¬ìš© ë°œê²¬ ì‹œ ë¹ ë¥´ê²Œ ëŒ€ì‘í•©ë‹ˆë‹¤. ğŸ•µï¸â€â™€ï¸
  </p>
</footer>

  <script>
    /* ---------------- ìƒìˆ˜ ---------------- */
    const SHEET_URL =
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vR7sUDMYoUsBpvEC9LjO25CnstexV74iKXfwRWVdqpQCOm65rzvJ6RrnedOv6JSqEYJNqyr2cje75CJ/pub?gid=0&single=true&output=csv';

    const START_AT_MS = new Date('2025-06-16T00:00:00+09:00').getTime();

    const TARGETS = {
      kakurenbo: 'ã‹ãã‚Œã‚“ã¼',
      rizz: 'Rizz - japanese Ver.',
      chroma: 'Chroma Drift - japanese Ver.'
    };

    const PER_CYCLE = {
      kakurenbo: 4,
      rizz: 3,
      chroma: 1
    };

    let schedule = [];

    /* ---------------- ìœ í‹¸ ---------------- */
    const toSec = (mmss) => {
      const [m, s] = mmss.split(':').map(Number);
      return m * 60 + s;
    };

    const formatKoreanTime = (str) => {
      const [m, s] = str.split(':').map(Number);
      return `${m}ë¶„ ${s.toString().padStart(2, '0')}ì´ˆ`;
    };

    /* ---------------- ì´ˆê¸° ë¡œë”© ---------------- */
    async function loadSchedule() {
      const res  = await fetch(SHEET_URL);
      const text = await res.text();
      const rows = text.trim().split('\n').slice(1);

      schedule = rows.map((line) => {
        const [title, start, end, cover] = line.split(',').map((s) => s.trim());
        return {
          title,
          start,
          end,
          cover,
          startSec: toSec(start),
          endSec  : toSec(end),
        };
      });

      renderPlaylist();
      tick();
      setInterval(tick, 1000);
    }

    /* ---------------- ë Œë” í•¨ìˆ˜ ---------------- */
    function renderPlaylist() {
      const ul = document.getElementById('playlist');
      ul.innerHTML = schedule
        .map(
          (item, i) => `
          <li data-index="${i}" class="flex flex-col p-3 rounded-lg shadow w-full opacity-50 transition-all bg-white">
            <div class="flex items-center">
              <div class="w-12 h-12 flex-shrink-0 bg-gray-200 rounded overflow-hidden">
                <img src="${item.cover}" alt="${item.title}" class="w-full h-full object-cover" />
              </div>
              <div class="ml-4 flex-1">
                <p class="text-sm font-medium">${i + 1}. ${item.title}</p>
                <p class="text-xs text-gray-500">${formatKoreanTime(item.start)} ~ ${formatKoreanTime(item.end)}</p>
              </div>
            </div>
            <!-- ì§„í–‰ ë°” -->
            <div class="w-full h-1 bg-gray-200 rounded overflow-hidden mt-2">
              <div id="p-${i}" class="h-full bg-blue-400 transition-all" style="width:0%"></div>
            </div>
          </li>
        `
        )
        .join('');
    }

    /* ---------------- ë©”ì¸ Tick ---------------- */
    function tick() {
      const diffSec   = Math.max(0, Math.floor((Date.now() - START_AT_MS) / 1000));
      const cycles    = Math.floor(diffSec / 3600);
      const secInLoop = diffSec % 3600;

      updateHighlight(secInLoop);
      updateCounts(cycles, secInLoop);
      updateProgress(secInLoop);
    }

    /* ----- í˜„ì¬ ì¬ìƒ í•­ëª© ê°•ì¡° ----- */
    function updateHighlight(secInLoop) {
      const idx = schedule.findIndex(
        (item) => secInLoop >= item.startSec && secInLoop < item.endSec,
      );

      document.querySelectorAll('#playlist li').forEach((li) => {
        const i = Number(li.dataset.index);
        if (i === idx) {
          li.classList.remove('opacity-50');
          li.classList.add('opacity-100', 'playing');
        } else {
          li.classList.add('opacity-50');
          li.classList.remove('opacity-100', 'playing');
        }
      });
    }

    /* ----- ì§„í–‰ ë°” ê°±ì‹  ----- */
    function updateProgress(secInLoop) {
      schedule.forEach((item, i) => {
        const bar = document.getElementById(`p-${i}`);
        if (!bar) return;
        if (secInLoop >= item.startSec && secInLoop < item.endSec) {
          const pct = ((secInLoop - item.startSec) / (item.endSec - item.startSec)) * 100;
          bar.style.width = `${pct}%`;
        } else {
          bar.style.width = '0%';
        }
      });
    }

    /* ----- ëˆ„ì  ì¹´ìš´íŠ¸ ê³„ì‚° ----- */
    function updateCounts(cycles, secInLoop) {
      const counts = {
        kakurenbo: cycles * PER_CYCLE.kakurenbo,
        rizz: cycles * PER_CYCLE.rizz,
        chroma: cycles * PER_CYCLE.chroma,
      };

      schedule.forEach((item) => {
        if (item.startSec <= secInLoop) {
          if (item.title === TARGETS.kakurenbo) counts.kakurenbo += 1;
          else if (item.title === TARGETS.rizz) counts.rizz += 1;
          else if (item.title === TARGETS.chroma) counts.chroma += 1;
        }
      });

      document.getElementById('count-kakurenbo').textContent = counts.kakurenbo;
      document.getElementById('count-rizz').textContent       = counts.rizz;
      document.getElementById('count-chroma').textContent     = counts.chroma;
    }

    /* ---------------- ì‹œì‘ ---------------- */
    loadSchedule();
  </script>
</body>
</html>
